# è°ƒè¯•æŒ‡å— - LaTeX æ¸²æŸ“é—®é¢˜

## ğŸ” é—®é¢˜ç—‡çŠ¶

- LaTeX å…¬å¼ä¸èƒ½æ­£å¸¸è§£æ
- æ¯æ¬¡éœ€è¦åˆ·æ–°é¡µé¢æ‰èƒ½çœ‹åˆ°æ­£ç¡®æ ¼å¼
- æµå¼è¾“å‡ºå®Œæˆåæ˜¾ç¤ºä¸æ­£ç¡®

## âœ… éªŒè¯æ­¥éª¤

### æ­¥éª¤ 1ï¼šéªŒè¯å¤„ç†å™¨å‡½æ•°

è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š
```bash
node test-latex-processor.js
```

**æœŸæœ›ç»“æœï¼š** æ‰€æœ‰æµ‹è¯•é€šè¿‡ âœ…

**å¦‚æœå¤±è´¥ï¼š** å¤„ç†å™¨é€»è¾‘æœ‰é—®é¢˜ï¼Œéœ€è¦ä¿®å¤ `src/lib/latex-processor.ts`

### æ­¥éª¤ 2ï¼šæ¸…é™¤æ‰€æœ‰ç¼“å­˜

```bash
# 1. åˆ é™¤ Next.js ç¼“å­˜
rm -rf .next

# 2. åˆ é™¤ node_modulesï¼ˆå¯é€‰ï¼Œå¦‚æœé—®é¢˜æŒç»­ï¼‰
rm -rf node_modules
npm install

# 3. é‡æ–°æ„å»º
npm run build
```

### æ­¥éª¤ 3ï¼šæ¸…é™¤æµè§ˆå™¨ç¼“å­˜

**Chrome/Edgeï¼š**
1. æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. å³é”®ç‚¹å‡»åˆ·æ–°æŒ‰é’®
3. é€‰æ‹©"æ¸…ç©ºç¼“å­˜å¹¶ç¡¬æ€§é‡æ–°åŠ è½½"

**æˆ–è€…ï¼š**
- Windows: `Ctrl + Shift + Delete`
- Mac: `Cmd + Shift + Delete`
- é€‰æ‹©"ç¼“å­˜çš„å›¾ç‰‡å’Œæ–‡ä»¶"
- ç‚¹å‡»"æ¸…é™¤æ•°æ®"

### æ­¥éª¤ 4ï¼šæ£€æŸ¥å¼€å‘æ¨¡å¼

å¦‚æœä½ åœ¨ä½¿ç”¨ `npm run dev`ï¼š

```bash
# 1. åœæ­¢å¼€å‘æœåŠ¡å™¨ï¼ˆCtrl+Cï¼‰
# 2. æ¸…é™¤ç¼“å­˜
rm -rf .next
# 3. é‡æ–°å¯åŠ¨
npm run dev
```

### æ­¥éª¤ 5ï¼šæ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°

1. æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. åˆ‡æ¢åˆ° Console æ ‡ç­¾
3. æŸ¥æ‰¾é”™è¯¯ä¿¡æ¯

**å¸¸è§é”™è¯¯ï¼š**
- `Cannot find module '@/lib/latex-processor'` - æ¨¡å—æœªæ‰¾åˆ°
- `processLatexInMarkdown is not a function` - å¯¼å…¥é”™è¯¯
- KaTeX ç›¸å…³é”™è¯¯ - CSS æœªåŠ è½½

### æ­¥éª¤ 6ï¼šæ£€æŸ¥ç½‘ç»œé¢æ¿

1. æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. åˆ‡æ¢åˆ° Network æ ‡ç­¾
3. åˆ·æ–°é¡µé¢
4. æŸ¥æ‰¾ `latex-processor` ç›¸å…³çš„ JS æ–‡ä»¶

**æ£€æŸ¥ï¼š**
- æ–‡ä»¶æ˜¯å¦æˆåŠŸåŠ è½½ï¼ˆçŠ¶æ€ç  200ï¼‰
- æ–‡ä»¶å¤§å°æ˜¯å¦æ­£ç¡®ï¼ˆä¸æ˜¯ 0 å­—èŠ‚ï¼‰
- æ–‡ä»¶å†…å®¹æ˜¯å¦åŒ…å«æœ€æ–°ä»£ç 

### æ­¥éª¤ 7ï¼šæ£€æŸ¥ React DevTools

1. å®‰è£… React DevTools æ‰©å±•
2. æ‰“å¼€å¼€å‘è€…å·¥å…·
3. åˆ‡æ¢åˆ° Components æ ‡ç­¾
4. æ‰¾åˆ° `ChatMessage` ç»„ä»¶
5. æŸ¥çœ‹ props å’Œ state

**æ£€æŸ¥ï¼š**
- `message.content` æ˜¯å¦æ­£ç¡®
- `processedContent` æ˜¯å¦åŒ…å« `$$`
- ç»„ä»¶æ˜¯å¦é‡æ–°æ¸²æŸ“

## ğŸ› å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜ 1ï¼šå…¬å¼æ˜¾ç¤ºä¸ºçº¯æ–‡æœ¬

**ç—‡çŠ¶ï¼š** `$$e^{i\pi} + 1 = 0$$` æ˜¾ç¤ºä¸ºçº¯æ–‡æœ¬

**å¯èƒ½åŸå› ï¼š**
1. KaTeX CSS æœªåŠ è½½
2. ReactMarkdown é…ç½®é”™è¯¯
3. å¤„ç†å™¨æœªè¿è¡Œ

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ£€æŸ¥ KaTeX æ˜¯å¦å®‰è£…
npm list katex

# å¦‚æœæœªå®‰è£…æˆ–ç‰ˆæœ¬ä¸å¯¹
npm install katex@^0.16.28 rehype-katex@^7.0.1 remark-math@^6.0.0
```

### é—®é¢˜ 2ï¼šåˆ·æ–°åæ‰èƒ½çœ‹åˆ°æ­£ç¡®æ ¼å¼

**ç—‡çŠ¶ï¼š** æµå¼è¾“å‡ºå®Œæˆåæ˜¾ç¤ºä¸æ­£ç¡®ï¼Œåˆ·æ–°åæ­£ç¡®

**å¯èƒ½åŸå› ï¼š**
1. `StreamingMessage` å’Œ `ChatMessage` ä½¿ç”¨ä¸åŒçš„å¤„ç†é€»è¾‘
2. React æ²¡æœ‰æ£€æµ‹åˆ°çŠ¶æ€å˜åŒ–
3. ç»„ä»¶æ²¡æœ‰é‡æ–°æ¸²æŸ“

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®ä¿ä¸¤ä¸ªç»„ä»¶éƒ½ä½¿ç”¨ `processLatexInMarkdown`
2. æ£€æŸ¥ `useEffect` ä¾èµ–é¡¹
3. æ·»åŠ è°ƒè¯•æ—¥å¿—

### é—®é¢˜ 3ï¼šæŸäº›å…¬å¼èƒ½æ¸²æŸ“ï¼ŒæŸäº›ä¸èƒ½

**ç—‡çŠ¶ï¼š** è¡Œå†…å…¬å¼ `$x$` èƒ½æ¸²æŸ“ï¼Œä½† `\(x\)` ä¸èƒ½

**å¯èƒ½åŸå› ï¼š**
- å¤„ç†å™¨æ²¡æœ‰è½¬æ¢ `\(` å’Œ `\)` æ ¼å¼

**è§£å†³æ–¹æ¡ˆï¼š**
æ£€æŸ¥ `src/lib/latex-processor.ts` ç¬¬ 20-22 è¡Œï¼š
```typescript
// 2. è½¬æ¢ \( \) æ ¼å¼ä¸º $...$ ï¼ˆè¡Œå†…å…¬å¼ï¼‰
processed = processed.replace(/\\\(/g, '$')
processed = processed.replace(/\\\)/g, '$')
```

### é—®é¢˜ 4ï¼šå¼€å‘æ¨¡å¼æ­£å¸¸ï¼Œç”Ÿäº§æ¨¡å¼ä¸æ­£å¸¸

**ç—‡çŠ¶ï¼š** `npm run dev` æ­£å¸¸ï¼Œä½† `npm run build` åä¸æ­£å¸¸

**å¯èƒ½åŸå› ï¼š**
- ç”Ÿäº§æ„å»ºä¼˜åŒ–å¯¼è‡´ä»£ç è¢«é”™è¯¯å¤„ç†
- ç¯å¢ƒå˜é‡ä¸åŒ

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ¸…é™¤æ„å»ºç¼“å­˜
rm -rf .next
rm -rf out

# é‡æ–°æ„å»º
npm run build

# æœ¬åœ°æµ‹è¯•ç”Ÿäº§æ„å»º
npm start
```

## ğŸ”§ è°ƒè¯•ä»£ç 

### åœ¨ ChatMessage.tsx ä¸­æ·»åŠ è°ƒè¯•æ—¥å¿—

```typescript
export function ChatMessage({ message }: ChatMessageProps) {
  const isUser = message.role === 'user'
  
  const processedContent = React.useMemo(() => {
    if (isUser) return message.content
    
    const result = processLatexInMarkdown(message.content, false)
    
    // è°ƒè¯•æ—¥å¿—
    console.log('=== ChatMessage å¤„ç† ===')
    console.log('åŸå§‹å†…å®¹:', message.content.substring(0, 100))
    console.log('å¤„ç†å:', result.substring(0, 100))
    console.log('åŒ…å« $$:', result.includes('$$'))
    
    return result
  }, [message.content, isUser])
  
  // ...
}
```

### åœ¨ StreamingMessage.tsx ä¸­æ·»åŠ è°ƒè¯•æ—¥å¿—

```typescript
export function StreamingMessage({ content, isComplete }: Props) {
  const renderContent = processLatexInMarkdown(content, !isComplete)
  
  // è°ƒè¯•æ—¥å¿—
  console.log('=== StreamingMessage å¤„ç† ===')
  console.log('åŸå§‹å†…å®¹:', content.substring(0, 100))
  console.log('å¤„ç†å:', renderContent.substring(0, 100))
  console.log('åŒ…å« $$:', renderContent.includes('$$'))
  console.log('isComplete:', isComplete)
  
  // ...
}
```

### åœ¨æµè§ˆå™¨æ§åˆ¶å°æµ‹è¯•

æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼Œè¿è¡Œï¼š

```javascript
// æµ‹è¯•å¤„ç†å™¨æ˜¯å¦å¯ç”¨
const test = '$$e^{i\\pi} + 1 = 0$$'
console.log('æµ‹è¯•è¾“å…¥:', test)

// å¦‚æœèƒ½è®¿é—®åˆ°å¤„ç†å™¨
// import { processLatexInMarkdown } from '@/lib/latex-processor'
// console.log('å¤„ç†å:', processLatexInMarkdown(test, false))
```

## ğŸ“‹ æ£€æŸ¥æ¸…å•

åœ¨æŠ¥å‘Šé—®é¢˜å‰ï¼Œè¯·ç¡®è®¤ï¼š

- [ ] å·²è¿è¡Œ `node test-latex-processor.js`ï¼Œæ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] å·²æ¸…é™¤ `.next` ç›®å½•
- [ ] å·²æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
- [ ] å·²ç¡¬åˆ·æ–°é¡µé¢ï¼ˆCtrl+Shift+Rï¼‰
- [ ] å·²æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°ï¼Œæ— é”™è¯¯
- [ ] å·²æ£€æŸ¥ç½‘ç»œé¢æ¿ï¼Œæ‰€æœ‰æ–‡ä»¶åŠ è½½æˆåŠŸ
- [ ] å·²é‡å¯å¼€å‘æœåŠ¡å™¨ï¼ˆå¦‚æœä½¿ç”¨ `npm run dev`ï¼‰
- [ ] å·²å°è¯•åœ¨éšèº«æ¨¡å¼ä¸‹æ‰“å¼€

## ğŸ†˜ å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨

è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **æµè§ˆå™¨æ§åˆ¶å°çš„å®Œæ•´é”™è¯¯ä¿¡æ¯**
2. **ç½‘ç»œé¢æ¿çš„æˆªå›¾**ï¼ˆæ˜¾ç¤ºåŠ è½½çš„ JS æ–‡ä»¶ï¼‰
3. **React DevTools çš„æˆªå›¾**ï¼ˆæ˜¾ç¤º ChatMessage ç»„ä»¶çš„ propsï¼‰
4. **å…·ä½“çš„è¾“å…¥å’Œè¾“å‡º**
   - è¾“å…¥ï¼šAI è¿”å›çš„åŸå§‹å†…å®¹
   - è¾“å‡ºï¼šæµè§ˆå™¨æ˜¾ç¤ºçš„å†…å®¹
   - æœŸæœ›ï¼šåº”è¯¥æ˜¾ç¤ºçš„å†…å®¹
5. **è¿è¡Œæ¨¡å¼**ï¼šå¼€å‘æ¨¡å¼ï¼ˆ`npm run dev`ï¼‰è¿˜æ˜¯ç”Ÿäº§æ¨¡å¼ï¼ˆ`npm run build` + `npm start`ï¼‰

## ğŸ¯ å¿«é€Ÿä¿®å¤å°è¯•

å¦‚æœä¸Šè¿°æ­¥éª¤éƒ½ä¸è¡Œï¼Œå°è¯•è¿™ä¸ª"æ ¸å¼¹"æ–¹æ¡ˆï¼š

```bash
# 1. å®Œå…¨æ¸…é™¤
rm -rf .next
rm -rf node_modules
rm -rf package-lock.json

# 2. é‡æ–°å®‰è£…
npm install

# 3. é‡æ–°æ„å»º
npm run build

# 4. æ¸…é™¤æµè§ˆå™¨æ‰€æœ‰æ•°æ®
# åœ¨æµè§ˆå™¨è®¾ç½®ä¸­æ¸…é™¤æ‰€æœ‰ç¼“å­˜ã€Cookieã€æœ¬åœ°å­˜å‚¨

# 5. é‡å¯æµè§ˆå™¨

# 6. è®¿é—®åº”ç”¨
npm start
```

---

**åˆ›å»ºæ—¶é—´ï¼š** 2026-02-01  
**ç”¨é€”ï¼š** è¯Šæ–­ LaTeX æ¸²æŸ“é—®é¢˜  
**çŠ¶æ€ï¼š** æ´»è·ƒ
