# 学习流程重新设计

## 问题分析

### 原有问题
1. **章节目录混乱** - Sidebar 显示了所有文档的所有章节
2. **信息组织混乱** - 题目信息混在 Sidebar 中
3. **缺少文档选择** - 没有明确的文档选择流程

### 设计原则
参考 `design-system/edugenius/MASTER.md`:
- 极简黑白美学
- Claymorphism 风格
- 清晰的信息层级
- 流畅的用户体验

## 新的学习流程

### 1. 文档选择页面 (`/study`)
**URL**: `/study`

**功能**:
- 显示用户上传的所有教材
- 卡片式布局，每个教材一张卡片
- 显示教材标题、章节数量
- 点击卡片进入章节选择

**设计**:
```
┌─────────────────────────────────────┐
│  选择学习教材                        │
│  从您上传的教材中选择一本开始学习     │
├─────────────────────────────────────┤
│                                     │
│  ┌──────┐  ┌──────┐  ┌──────┐     │
│  │ 📖   │  │ 📖   │  │ 📖   │     │
│  │教材1 │  │教材2 │  │教材3 │     │
│  │5章节 │  │8章节 │  │3章节 │     │
│  └──────┘  └──────┘  └──────┘     │
│                                     │
└─────────────────────────────────────┘
```

### 2. 章节选择页面 (`/study?doc=X`)
**URL**: `/study?doc=1`

**功能**:
- 显示选中教材的所有章节
- 显示章节状态（未开始、学习中、已完成、已锁定）
- 显示完成度进度条
- 显示解锁条件
- 点击章节进入学习

**设计**:
```
┌─────────────────────────────────────┐
│  ← 返回教材列表                      │
│                                     │
│  线性代数与微积分                    │
│  共 5 个章节                         │
├─────────────────────────────────────┤
│                                     │
│  ┌─────────────────────────────┐   │
│  │ 1  第一章：线性代数基础      │   │
│  │    未开始  完成度 0%    →   │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ 🔒 第二章：微积分入门        │   │
│  │    需完成前一章              │   │
│  └─────────────────────────────┘   │
│                                     │
└─────────────────────────────────────┘
```

### 3. 学习对话页面 (`/study?doc=X&chapter=Y`)
**URL**: `/study?doc=1&chapter=1`

**功能**:
- 左侧：AI 对话界面
- 右侧：学习侧边栏
  - 显示当前教材和章节
  - 显示导师风格
  - 显示核心考点（从对话中提取）
  - 返回章节列表按钮

**设计**:
```
┌──────────────────────┬──────────────┐
│                      │ 当前教材     │
│  AI 对话界面         │ 线性代数     │
│                      │              │
│  用户: 什么是向量？  │ 当前章节     │
│                      │ 第一章       │
│  AI: 向量是...       │              │
│                      │ [返回章节]   │
│                      ├──────────────┤
│                      │ 导师风格     │
│                      │ L3 标准      │
│                      ├──────────────┤
│                      │ 核心考点     │
│                      │ □ 向量定义   │
│                      │ □ 向量运算   │
│                      │              │
└──────────────────────┴──────────────┘
```

### 4. Quiz 页面 (`/quiz?doc=X&chapter=Y`)
**URL**: `/quiz?doc=1&chapter=1`

**功能**:
- 专门的做题界面
- 显示题目、选项、答案
- 记录答题历史
- 显示正确率统计

**设计**:
```
┌─────────────────────────────────────┐
│  第一章测验                          │
│  已完成 3/10 题                      │
├─────────────────────────────────────┤
│                                     │
│  题目 4:                            │
│  向量的模长公式是？                  │
│                                     │
│  ○ A. |v| = √(x² + y²)             │
│  ○ B. |v| = x + y                  │
│  ○ C. |v| = x² + y²                │
│  ○ D. |v| = √(x + y)               │
│                                     │
│  [提交答案]                          │
│                                     │
└─────────────────────────────────────┘
```

## 代码修改

### 前端修改

#### 1. `/src/app/study/page.tsx` - 完全重写
- 实现三层路由逻辑
- 文档选择 → 章节选择 → 学习对话
- 使用 URL 参数控制显示内容

#### 2. `/src/components/chat/StudySidebar.tsx` - 更新
- 添加 `documentTitle` 属性
- 添加 `onBackToChapters` 回调
- 移除底部的章节信息（已移到顶部）
- 核心考点为空时显示提示

#### 3. `/src/components/chat/StudyChat.tsx` - 更新
- 添加 `documentId` 参数
- 用于后续的对话历史记录

### 后端修改
无需修改，现有 API 已满足需求：
- `GET /api/documents/list` - 获取文档列表
- `GET /api/documents/{id}/chapters` - 获取章节列表
- `POST /api/teaching/chat` - 学习对话

## 信息架构

### 层级关系
```
用户
└── 教材列表
    └── 教材 A
        ├── 章节 1
        │   ├── 学习对话
        │   ├── 核心考点
        │   └── 测验题目
        ├── 章节 2
        └── 章节 3
```

### 数据隔离
- **Sidebar**: 只显示当前章节的信息
- **Quiz 页面**: 只显示当前章节的题目
- **对话历史**: 按文档和章节分组

## 用户体验优化

### 导航流程
1. 用户访问 `/study`
2. 看到所有教材，选择一本
3. 看到该教材的所有章节，选择一章
4. 进入学习对话界面
5. 可以随时返回章节列表或教材列表

### 状态管理
- 使用 URL 参数管理状态
- 刷新页面不会丢失位置
- 可以直接分享学习链接

### 视觉反馈
- 章节锁定状态清晰可见
- 完成度进度条实时更新
- 平滑的页面过渡动画

## 下一步优化

### 短期
1. 从后端获取章节知识点
2. 实现 Quiz 页面
3. 添加学习进度统计

### 长期
1. 添加学习笔记功能
2. 实现错题本
3. 添加学习时长统计
4. 实现学习成就系统

## 总结

新的学习流程：
- ✅ 清晰的信息层级
- ✅ 专注的学习体验
- ✅ 符合设计规范
- ✅ 易于扩展维护

每个页面都有明确的职责，信息组织有序，用户体验流畅。
