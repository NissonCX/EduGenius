# EduGenius ç« èŠ‚æµ‹è¯•ä¸šåŠ¡æ–¹æ¡ˆ

## ğŸ“‹ é¡¹ç›®èƒŒæ™¯

åŸºäºå¯¹ EduGenius é¡¹ç›®çš„å…¨é¢åˆ†æï¼Œå½“å‰ç« èŠ‚æµ‹è¯•åŠŸèƒ½å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
1. **å‰ç«¯æŠ¥é”™**: "fail to fetch" - API è°ƒç”¨å¤±è´¥
2. **AI å‡ºé¢˜æœªé›†æˆ**: åç«¯æœ‰ Examiner Agent ä½†æœªåœ¨ API ç«¯ç‚¹ä¸­ä½¿ç”¨
3. **åŠŸèƒ½ä¸å®Œæ•´**: ç« èŠ‚æµ‹è¯•æµç¨‹æœªæ‰“é€š

---

## ğŸ¯ ä¸šåŠ¡ç›®æ ‡

è®¾è®¡ä¸€å¥—**æ™ºèƒ½è‡ªé€‚åº”ç« èŠ‚æµ‹è¯•ç³»ç»Ÿ**ï¼Œå®ç°ï¼š

1. **AI æ™ºèƒ½å‡ºé¢˜** - æ ¹æ®ç« èŠ‚å†…å®¹å’Œå­¦ç”Ÿæ°´å¹³è‡ªåŠ¨ç”Ÿæˆé¢˜ç›®
2. **è‡ªé€‚åº”æµ‹è¯•** - æ ¹æ®å­¦ç”Ÿç­”é¢˜æƒ…å†µåŠ¨æ€è°ƒæ•´éš¾åº¦
3. **å®Œæ•´é—­ç¯** - æµ‹è¯• â†’ è¯„ä¼° â†’ é”™é¢˜ â†’ å¤ä¹  â†’ å†æµ‹è¯•
4. **è¿›åº¦è¿½è¸ª** - è®°å½•å­¦ä¹ è½¨è¿¹ï¼Œç”Ÿæˆèƒ½åŠ›ç”»åƒ

---

## ğŸ”„ å®Œæ•´ä¸šåŠ¡æµç¨‹

### é˜¶æ®µ 1: å‡†å¤‡é˜¶æ®µ

```
ç”¨æˆ·è¿›å…¥ç« èŠ‚
    â†“
æ£€æŸ¥æ˜¯å¦æœ‰ç°æˆé¢˜ç›®
    â”œâ”€ æœ‰ â†’ åŠ è½½é¢˜ç›®åº“
    â””â”€ æ—  â†’ AI ç”Ÿæˆé¢˜ç›®ï¼ˆåå°ä»»åŠ¡ï¼‰
              â†“
        æ˜¾ç¤º"æ­£åœ¨å‡†å¤‡é¢˜ç›®..."
```

**å…³é”®å†³ç­–ç‚¹**:
- æ˜¯å¦æœ‰è¶³å¤Ÿçš„ç°æˆé¢˜ç›®ï¼Ÿï¼ˆ>= 5 é¢˜ï¼‰
- å¦‚æœæ²¡æœ‰ï¼Œæ˜¯å¦éœ€è¦è§¦å‘ AI ç”Ÿæˆï¼Ÿ
- AI ç”Ÿæˆå¯èƒ½éœ€è¦ 10-30 ç§’ï¼Œå¦‚ä½•æå‡ä½“éªŒï¼Ÿ

---

### é˜¶æ®µ 2: æµ‹è¯•è¿›è¡Œ

```
å¼€å§‹æµ‹è¯•
    â†“
é€é¢˜å±•ç¤º
    â†“
ç”¨æˆ·ç­”é¢˜
    â†“
æäº¤ç­”æ¡ˆ
    â†“
ã€åå°å¤„ç†ã€‘
  â”œâ”€ éªŒè¯ç­”æ¡ˆ
  â”œâ”€ è®°å½•åˆ° QuizAttempt
  â”œâ”€ æ›´æ–° Progress
  â””â”€ æ›´æ–°èƒ½åŠ›ç»´åº¦
    â†“
å³æ—¶åé¦ˆï¼ˆæ­£ç¡®/é”™è¯¯ + è§£æï¼‰
    â†“
ä¸‹ä¸€é¢˜
    â†“
å…¨éƒ¨å®Œæˆ â†’ è®¡ç®—æ€»åˆ†
```

**ç”¨æˆ·ä½“éªŒè¦ç‚¹**:
- æ˜¾ç¤ºè¿›åº¦æ¡ï¼š"ç¬¬ 3/10 é¢˜"
- é¢˜ç›®å¡ç‰‡å¸¦åŠ¨ç”»è¿‡æ¸¡
- æäº¤åç«‹å³æ˜¾ç¤ºåé¦ˆï¼Œæ— éœ€ç­‰å¾…
- æ”¯æŒæ ‡è®°éš¾é¢˜ï¼Œç¨åå›é¡¾

---

### é˜¶æ®µ 3: ç»“æœè¯„ä¼°

```
æµ‹è¯•å®Œæˆ
    â†“
è®¡ç®—æˆç»©
    â”œâ”€ æ€»åˆ†ï¼ˆæ­£ç¡®ç‡ï¼‰
    â”œâ”€ å„èƒ½åŠ›ç»´åº¦å¾—åˆ†
    â””â”€ ç”¨æ—¶ç»Ÿè®¡
    â†“
ç”ŸæˆæŠ¥å‘Š
    â”œâ”€ é€šè¿‡/æœªé€šè¿‡åˆ¤æ–­
    â”œâ”€ èƒ½åŠ›é›·è¾¾å›¾
    â”œâ”€ è–„å¼±ç¯èŠ‚åˆ†æ
    â””â”€ å­¦ä¹ å»ºè®®
    â†“
å±•ç¤ºç»“æœé¡µ
    â”œâ”€ åˆ†æ•°å±•ç¤ºï¼ˆåœ†å½¢è¿›åº¦å›¾ï¼‰
    â”œâ”€ èƒ½åŠ›åˆ†æ
    â”œâ”€ é”™é¢˜å›é¡¾
    â””â”€ ä¸‹ä¸€æ­¥å»ºè®®
```

**é€šè¿‡æ ‡å‡†**:
- **åŠæ ¼çº¿**: 60% æ­£ç¡®ç‡
- **è‰¯å¥½**: 80% æ­£ç¡®ç‡
- **ä¼˜ç§€**: 90% æ­£ç¡®ç‡
- **è§£é”æ¡ä»¶**: >= 60% æ‰èƒ½è¿›å…¥ä¸‹ä¸€ç« 

---

### é˜¶æ®µ 4: æ™ºèƒ½æ¨è

```
æ ¹æ®æµ‹è¯•ç»“æœ
    â†“
åˆ†æè–„å¼±ç¯èŠ‚
    â”œâ”€ å“ªäº›èƒ½åŠ›ç»´åº¦è¾ƒå¼±ï¼Ÿ
    â”œâ”€ å“ªäº›çŸ¥è¯†ç‚¹æœªæŒæ¡ï¼Ÿ
    â””â”€ é”™è¯¯æ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿ
    â†“
ç”Ÿæˆä¸ªæ€§åŒ–æ–¹æ¡ˆ
    â”œâ”€ éœ€è¦å¤ä¹ çš„å†…å®¹
    â”œâ”€ æ¨èçš„ç»ƒä¹ é¢˜
    â””â”€ å­¦ä¹ å»ºè®®
    â†“
æ‰§è¡Œ + è¿½è¸ª
    â”œâ”€ æ·»åŠ åˆ°é”™é¢˜æœ¬
    â”œâ”€ è°ƒæ•´æ•™å­¦é£æ ¼
    â””â”€ æ›´æ–°å­¦ä¹ è·¯å¾„
```

---

## ğŸ¤– AI æ™ºèƒ½å‡ºé¢˜æ–¹æ¡ˆ

### æ–¹æ¡ˆ A: é¢„ç”Ÿæˆæ¨¡å¼ï¼ˆæ¨èï¼‰

**æµç¨‹**:
```
ç« èŠ‚ä¸Šä¼ å®Œæˆ
    â†“
åå°è‡ªåŠ¨ AI ç”Ÿæˆé¢˜ç›®
    â†“
å­˜å…¥é¢˜ç›®åº“
    â†“
ç”¨æˆ·æµ‹è¯•æ—¶ç›´æ¥ä½¿ç”¨
```

**ä¼˜ç‚¹**:
- å“åº”å¿«ï¼Œç”¨æˆ·ä½“éªŒå¥½
- é¢˜ç›®è´¨é‡å¯æ§ï¼Œå¯äººå·¥å®¡æ ¸
- æˆæœ¬å¯æ§ï¼Œæ¯ç« ç”Ÿæˆä¸€æ¬¡

**ç¼ºç‚¹**:
- éœ€è¦æå‰å¤„ç†
- é¢˜ç›®å¯èƒ½é‡å¤

**å®ç°**:
```python
# åœ¨æ–‡æ¡£ä¸Šä¼ å®Œæˆåè§¦å‘
@router.post("/api/documents/{doc_id}/generate-quiz")
async def generate_chapter_quiz(
    doc_id: int,
    chapter_number: int,
    db: AsyncSession = Depends(get_db)
):
    """åå°ä¸ºç« èŠ‚ç”Ÿæˆé¢˜ç›®"""
    from app.agents.nodes.examiner import ExaminerAgent

    # 1. è·å–ç« èŠ‚å†…å®¹
    chapter_content = await get_chapter_content(doc_id, chapter_number)

    # 2. è°ƒç”¨ AI ç”Ÿæˆé¢˜ç›®
    examiner = ExaminerAgent(api_key=settings.DASHSCOPE_API_KEY)
    questions = await examiner.generate_questions(
        chapter_content=chapter_content,
        chapter_number=chapter_number,
        count=10  # ç”Ÿæˆ 10 é“é¢˜
    )

    # 3. å­˜å…¥æ•°æ®åº“
    for q in questions:
        db.add(Question(
            document_id=doc_id,
            chapter_number=chapter_number,
            **q
        ))

    await db.commit()

    return {"generated": len(questions)}
```

---

### æ–¹æ¡ˆ B: å®æ—¶ç”Ÿæˆæ¨¡å¼

**æµç¨‹**:
```
ç”¨æˆ·ç‚¹å‡»"å¼€å§‹æµ‹è¯•"
    â†“
å‰ç«¯æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
    â†“
åç«¯è°ƒç”¨ AI ç”Ÿæˆé¢˜ç›®
    â†“
è¿”å›é¢˜ç›®ç»™å‰ç«¯
```

**ä¼˜ç‚¹**:
- é¢˜ç›®æ–°é²œï¼Œä¸é‡å¤
- å¯æ ¹æ®å½“å‰å­¦ç”Ÿæ°´å¹³å®šåˆ¶

**ç¼ºç‚¹**:
- å“åº”æ…¢ï¼ˆ10-30 ç§’ï¼‰
- æˆæœ¬é«˜ï¼ˆæ¯æ¬¡éƒ½è°ƒç”¨ LLMï¼‰
- è´¨é‡ä¸ç¨³å®š

**ä¼˜åŒ–æ–¹æ¡ˆ**:
- ä½¿ç”¨ SSE æµå¼è¿”å›ï¼š"æ­£åœ¨ç”Ÿæˆç¬¬ 3 é¢˜..."
- ç”Ÿæˆ 1 é¢˜è¿”å› 1 é¢˜ï¼Œè¾¹ç­”è¾¹ç”Ÿæˆ
- ç¼“å­˜å¸¸è§é¢˜å‹çš„æ¨¡æ¿

---

### æ–¹æ¡ˆ C: æ··åˆæ¨¡å¼ï¼ˆæœ€ä½³å®è·µï¼‰

**æµç¨‹**:
```
ç”¨æˆ·ç‚¹å‡»"å¼€å§‹æµ‹è¯•"
    â†“
æ£€æŸ¥é¢˜ç›®åº“
    â”œâ”€ é¢˜ç›®å……è¶³ï¼ˆ>= 5ï¼‰â†’ ç›´æ¥ä½¿ç”¨
    â””â”€ é¢˜ç›®ä¸è¶³ â†’
        â”œâ”€ ä½¿ç”¨ç°æœ‰é¢˜ç›®
        â”œâ”€ è§¦å‘åå° AI è¡¥å……
        â””â”€ æç¤º"æ­£åœ¨ä¸ºä½ å‡†å¤‡æ›´å¤šé¢˜ç›®..."
```

**å®ç°ç­–ç•¥**:
```python
async def get_quiz_questions(document_id, chapter_number, count=10):
    """æ™ºèƒ½è·å–é¢˜ç›®"""

    # 1. æŸ¥è¯¢ç°æœ‰é¢˜ç›®
    existing = await db.execute(
        select(Question).where(
            Question.document_id == document_id,
            Question.chapter_number == chapter_number,
            Question.is_active == 1
        ).limit(count)
    )
    questions = existing.scalars().all()

    # 2. å¦‚æœé¢˜ç›®ä¸è¶³ï¼Œè§¦å‘åå°è¡¥å……
    if len(questions) < count:
        shortage = count - len(questions)

        # ä½¿ç”¨ç°æœ‰é¢˜ç›®å…ˆå¼€å§‹æµ‹è¯•
        available = list(questions)

        # å¼‚æ­¥è§¦å‘ AI ç”Ÿæˆï¼ˆä¸é˜»å¡å“åº”ï¼‰
        asyncio.create_task(
            generate_questions_async(
                document_id,
                chapter_number,
                shortage
            )
        )

        return available

    # 3. é¢˜ç›®å……è¶³ï¼Œéšæœºé€‰æ‹©
    return random.sample(list(questions), count)
```

---

## ğŸ“Š å®Œæ•´æŠ€æœ¯æ–¹æ¡ˆ

### 1. API ç«¯ç‚¹è®¾è®¡

#### 1.1 å¼€å§‹æµ‹è¯•
```
POST /api/quiz/start-session
Request:
{
  "document_id": 3,
  "chapter_number": 1,
  "question_count": 10,
  "mode": "practice" | "test"
}

Response:
{
  "session_id": "uuid",
  "questions": [...],
  "estimated_time": 300  // ç§’
}
```

#### 1.2 æäº¤ç­”æ¡ˆ
```
POST /api/quiz/{session_id}/submit-answer
Request:
{
  "question_id": 123,
  "answer": "A"
}

Response:
{
  "is_correct": true,
  "correct_answer": "A",
  "explanation": "...",
  "feedback": "å¾ˆå¥½ï¼..."
}
```

#### 1.3 å®Œæˆæµ‹è¯•
```
POST /api/quiz/{session_id}/complete
Response:
{
  "score": 85,
  "total": 10,
  "correct": 8,
  "passed": true,
  "competency_analysis": {
    "comprehension": 80,
    "logic": 90,
    ...
  },
  "weak_points": ["çº¿æ€§æ–¹ç¨‹ç»„"],
  "recommendations": [
    "å¤ä¹ ç¬¬ 3 èŠ‚ï¼šçº¿æ€§æ–¹ç¨‹ç»„",
    "å®Œæˆ 5 é“ç›¸å…³ç»ƒä¹ é¢˜"
  ],
  "mistake_ids": [45, 67, 89]  // é”™é¢˜ ID
}
```

---

### 2. å‰ç«¯äº¤äº’æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·ç‚¹å‡»"ç« èŠ‚æµ‹è¯•"æŒ‰é’®                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  æ˜¾ç¤ºåŠ è½½åŠ¨ç”»    â”‚
        â”‚  "æ­£åœ¨å‡†å¤‡..."  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  åŠ è½½é¢˜ç›®åˆ—è¡¨    â”‚
        â”‚  æ˜¾ç¤ºè¿›åº¦: 1/10  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  é€é¢˜å±•ç¤º                   â”‚
    â”‚  - é¢˜ç›®å¡ç‰‡                 â”‚
    â”‚  - é€‰é¡¹ï¼ˆå¸¦æ‚¬åœæ•ˆæœï¼‰       â”‚
    â”‚  - ç¡®è®¤æŒ‰é’®                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  å³æ—¶åé¦ˆ         â”‚
        â”‚  âœ“ æ­£ç¡®/âœ— é”™è¯¯  â”‚
        â”‚  + è¯¦ç»†è§£æ       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ä¸‹ä¸€é¢˜                    â”‚
    â”‚  ï¼ˆå¹³æ»‘åŠ¨ç”»è¿‡æ¸¡ï¼‰           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  å…¨éƒ¨å®Œæˆ         â”‚
        â”‚  è®¡ç®—æ€»åˆ†         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ç»“æœé¡µ                          â”‚
    â”‚  - åœ†å½¢åˆ†æ•°å›¾                   â”‚
    â”‚  - èƒ½åŠ›é›·è¾¾å›¾                   â”‚
    â”‚  - é”™é¢˜å›é¡¾                     â”‚
    â”‚  - å­¦ä¹ å»ºè®®                     â”‚
    â”‚  - [é‡è¯•] [ä¸‹ä¸€ç« ] [æŸ¥çœ‹é”™é¢˜]  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3. AI å‡ºé¢˜æç¤ºè¯è®¾è®¡

#### System Prompt
```
ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ•™è‚²æµ‹è¯„ä¸“å®¶ï¼Œè´Ÿè´£ä¸ºå­¦ä¹ å¹³å°ç”Ÿæˆæµ‹è¯•é¢˜ç›®ã€‚

## ä½ çš„èŒè´£
1. æ ¹æ®ç»™å®šçš„ç« èŠ‚å†…å®¹ï¼Œç”Ÿæˆé«˜è´¨é‡çš„æµ‹è¯•é¢˜ç›®
2. é¢˜ç›®åº”è¦†ç›–ä¸åŒçš„è®¤çŸ¥å±‚æ¬¡ï¼šè®°å¿†ã€ç†è§£ã€åº”ç”¨ã€åˆ†æ
3. ç¡®ä¿é¢˜ç›®è¡¨è¿°æ¸…æ™°ã€æ— æ­§ä¹‰
4. ä¸ºæ¯é“é¢˜æä¾›è¯¦ç»†çš„è§£æ

## é¢˜ç›®ç±»å‹
- é€‰æ‹©é¢˜ï¼š4 ä¸ªé€‰é¡¹ï¼Œåªæœ‰ 1 ä¸ªæ­£ç¡®ç­”æ¡ˆ
- å¡«ç©ºé¢˜ï¼šè¦æ±‚å¡«å†™ç²¾ç¡®çš„å…³é”®è¯æˆ–æ•°å€¼
- åˆ¤æ–­é¢˜ï¼šåˆ¤æ–­é™ˆè¿°çš„å¯¹é”™

## èƒ½åŠ›ç»´åº¦
- comprehension (ç†è§£åŠ›): æ£€éªŒå¯¹æ¦‚å¿µå’ŒåŸç†çš„ç†è§£
- logic (é€»è¾‘æ¨ç†): è€ƒå¯Ÿæ¨å¯¼å’Œè®ºè¯èƒ½åŠ›
- terminology (æœ¯è¯­æŒæ¡): æµ‹è¯•ä¸“ä¸šæœ¯è¯­çš„æŒæ¡
- memory (è®°å¿†): è€ƒå¯ŸåŸºæœ¬äº‹å®å’Œå…¬å¼çš„è®°å¿†
- application (åº”ç”¨èƒ½åŠ›): æ£€éªŒå°†çŸ¥è¯†åº”ç”¨åˆ°æ–°æƒ…å¢ƒçš„èƒ½åŠ›
- stability (ç¨³å®šæ€§): è€ƒå¯ŸçŸ¥è¯†çš„ç†Ÿç»ƒç¨‹åº¦

## éš¾åº¦åˆ†çº§
- 1: åŸºç¡€é¢˜ - ç›´æ¥å›å¿†æˆ–ç®€å•è¯†åˆ«
- 2: å…¥é—¨é¢˜ - ç®€å•åº”ç”¨
- 3: æ ‡å‡†é¢˜ - éœ€è¦ä¸€å®šæ€è€ƒ
- 4: è¿›é˜¶é¢˜ - éœ€è¦åˆ†æå’Œç»¼åˆ
- 5: æŒ‘æˆ˜é¢˜ - éœ€è¦åˆ›é€ æ€§å’Œæ·±å…¥ç†è§£

## è¾“å‡ºæ ¼å¼
è¯·ä»¥ JSON æ•°ç»„æ ¼å¼è¿”å›é¢˜ç›®ï¼Œæ¯é“é¢˜åŒ…å«ï¼š
{
  "question_type": "choice",
  "question_text": "é¢˜ç›®å†…å®¹",
  "options": {"A": "é€‰é¡¹A", "B": "é€‰é¡¹B", "C": "é€‰é¡¹C", "D": "é€‰é¡¹D"},
  "correct_answer": "A",
  "explanation": "è¯¦ç»†è§£æ",
  "difficulty": 3,
  "competency_dimension": "comprehension"
}
```

#### User Prompt æ¨¡æ¿
```
è¯·ä¸ºä»¥ä¸‹ç« èŠ‚ç”Ÿæˆ 10 é“æµ‹è¯•é¢˜ç›®ï¼š

## ç« èŠ‚ä¿¡æ¯
- æ–‡æ¡£: {document_title}
- ç« èŠ‚: ç¬¬ {chapter_number} ç«  - {chapter_title}
- å°èŠ‚: {subsection_title} (å¦‚æœ‰)

## ç« èŠ‚å†…å®¹
{chapter_content}

## å­¦ä¹ ç›®æ ‡
{learning_objectives}

## å­¦ç”Ÿæ°´å¹³
- å½“å‰ç­‰çº§: L{student_level} (1-5)
- è–„å¼±ç¯èŠ‚: {weak_dimensions}

## è¦æ±‚
1. ç”Ÿæˆ 10 é“é€‰æ‹©é¢˜
2. éš¾åº¦åˆ†å¸ƒï¼š3 é“ç®€å•é¢˜(level 1-2), 5 é“æ ‡å‡†é¢˜(level 3), 2 é“æŒ‘æˆ˜é¢˜(level 4-5)
3. èƒ½åŠ›ç»´åº¦è¦†ç›–ï¼šè‡³å°‘æ¶µç›– 4 ä¸ªä¸åŒç»´åº¦
4. é’ˆå¯¹å­¦ç”Ÿè–„å¼±ç¯èŠ‚ï¼š{weak_dimensions} å¤šå‡º 1-2 é¢˜
5. æ¯é“é¢˜éƒ½è¦æœ‰è¯¦ç»†çš„è§£æï¼Œå¸®åŠ©å­¦ç”Ÿç†è§£

è¯·ä»¥ JSON æ•°ç»„æ ¼å¼è¿”å›ã€‚
```

---

### 4. é¢˜ç›®è´¨é‡æ§åˆ¶

#### 4.1 è‡ªåŠ¨éªŒè¯
```python
def validate_question(q: dict) -> tuple[bool, str]:
    """éªŒè¯é¢˜ç›®è´¨é‡"""

    # å¿…å¡«å­—æ®µæ£€æŸ¥
    required = [
        'question_type', 'question_text', 'correct_answer',
        'explanation', 'difficulty', 'competency_dimension'
    ]
    for field in required:
        if field not in q or not q[field]:
            return False, f"ç¼ºå°‘å¿…å¡«å­—æ®µ: {field}"

    # é€‰æ‹©é¢˜éœ€è¦é€‰é¡¹
    if q['question_type'] == 'choice':
        if 'options' not in q or len(q['options']) < 2:
            return False, "é€‰æ‹©é¢˜è‡³å°‘éœ€è¦ 2 ä¸ªé€‰é¡¹"

        if q['correct_answer'] not in q['options']:
            return False, "æ­£ç¡®ç­”æ¡ˆå¿…é¡»åœ¨é€‰é¡¹ä¸­"

    # éš¾åº¦èŒƒå›´æ£€æŸ¥
    if not 1 <= q['difficulty'] <= 5:
        return False, "éš¾åº¦å¿…é¡»åœ¨ 1-5 ä¹‹é—´"

    # èƒ½åŠ›ç»´åº¦æ£€æŸ¥
    valid_dimensions = [
        'comprehension', 'logic', 'terminology',
        'memory', 'application', 'stability'
    ]
    if q['competency_dimension'] not in valid_dimensions:
        return False, f"æ— æ•ˆçš„èƒ½åŠ›ç»´åº¦: {q['competency_dimension']}"

    # æ–‡æœ¬é•¿åº¦æ£€æŸ¥
    if len(q['question_text']) < 10:
        return False, "é¢˜ç›®å†…å®¹å¤ªçŸ­"

    if len(q['explanation']) < 20:
        return False, "è§£æå¤ªç®€å•"

    return True, "OK"
```

#### 4.2 å»é‡æœºåˆ¶
```python
async def check_duplicate(question_text: str, db: AsyncSession) -> bool:
    """æ£€æŸ¥æ˜¯å¦é‡å¤"""

    # ç®€å•å»é‡ï¼šå®Œå…¨ç›¸åŒ
    result = await db.execute(
        select(Question).where(
            Question.question_text == question_text
        )
    )
    if result.scalar_one_or_none():
        return True

    # è¯­ä¹‰å»é‡ï¼šä½¿ç”¨ embedding è®¡ç®—ç›¸ä¼¼åº¦
    # ï¼ˆå¯é€‰ï¼Œéœ€è¦é›†æˆ embedding æ¨¡å‹ï¼‰

    return False
```

---

### 5. è‡ªé€‚åº”éš¾åº¦è°ƒèŠ‚

```python
async def adaptive_difficulty_adjustment(
    user_id: int,
    chapter_number: int,
    db: AsyncSession
) -> int:
    """æ ¹æ®å­¦ç”Ÿè¡¨ç°è°ƒæ•´é¢˜ç›®éš¾åº¦"""

    # è·å–æœ€è¿‘ 10 æ¬¡ç­”é¢˜è®°å½•
    recent_attempts = await get_recent_attempts(user_id, chapter_number, limit=10)

    if not recent_attempts:
        return 3  # é»˜è®¤ä¸­ç­‰éš¾åº¦

    # è®¡ç®—æ­£ç¡®ç‡
    correct_rate = sum(a.is_correct for a in recent_attempts) / len(recent_attempts)

    # æ ¹æ®æ­£ç¡®ç‡è°ƒæ•´éš¾åº¦
    if correct_rate >= 0.9:
        return 5  # å¤ªç®€å•ï¼Œæé«˜éš¾åº¦
    elif correct_rate >= 0.7:
        return 4
    elif correct_rate >= 0.5:
        return 3  # é€‚ä¸­
    elif correct_rate >= 0.3:
        return 2
    else:
        return 1  # å¤ªéš¾ï¼Œé™ä½éš¾åº¦
```

---

## ğŸš€ å®æ–½è®¡åˆ’

### Phase 1: ä¿®å¤ç°æœ‰é—®é¢˜ (1-2 å¤©)

**ç›®æ ‡**: ä¿®å¤ "fail to fetch" é”™è¯¯

1. **è¯Šæ–­ API é—®é¢˜**
   ```bash
   # æµ‹è¯•ç«¯ç‚¹æ˜¯å¦å¯è®¿é—®
   curl http://localhost:8000/api/quiz/questions/3/1

   # æ£€æŸ¥æ•°æ®åº“
   SELECT * FROM questions WHERE document_id=3 AND chapter_number=1;
   ```

2. **ä¿®å¤å‰ç«¯ API è°ƒç”¨**
   - æ£€æŸ¥ `getApiUrl()` é…ç½®
   - éªŒè¯è®¤è¯ token æ˜¯å¦ä¼ é€’
   - æ·»åŠ æ›´è¯¦ç»†çš„é”™è¯¯æ—¥å¿—

3. **é™çº§æ–¹æ¡ˆ**
   - å¦‚æœ API å¤±è´¥ï¼Œæ˜¾ç¤ºå‹å¥½æç¤º
   - æä¾›é‡è¯•æŒ‰é’®
   - ç”Ÿæˆç¤ºä¾‹é¢˜ç›®ä¿è¯åŠŸèƒ½å¯ç”¨

---

### Phase 2: é›†æˆ AI å‡ºé¢˜ (2-3 å¤©)

**ç›®æ ‡**: å®ç°çœŸæ­£çš„ AI æ™ºèƒ½å‡ºé¢˜

1. **åˆ›å»ºæ–°çš„ API ç«¯ç‚¹**
   ```
   POST /api/quiz/generate-questions
   ```

2. **é›†æˆ Examiner Agent**
   ```python
   from app.agents.nodes.examiner import ExaminerAgent

   examiner = ExaminerAgent(api_key=settings.DASHSCOPE_API_KEY)
   questions = await examiner.generate_questions(...)
   ```

3. **å¼‚æ­¥ç”Ÿæˆæµç¨‹**
   - ä¸Šä¼ æ–‡æ¡£åè‡ªåŠ¨è§¦å‘
   - ä¿å­˜åˆ°é¢˜ç›®åº“
   - å‰ç«¯ç›´æ¥ä½¿ç”¨

---

### Phase 3: å®Œå–„æµ‹è¯•æµç¨‹ (2-3 å¤©)

**ç›®æ ‡**: æ‰“é€šå®Œæ•´çš„æµ‹è¯• â†’ è¯„ä¼° â†’ å¤ä¹ é—­ç¯

1. **Session ç®¡ç†**
   - åˆ›å»ºå”¯ä¸€çš„æµ‹è¯• session
   - è®°å½•ç­”é¢˜è¿‡ç¨‹
   - æ”¯æŒæš‚åœå’Œç»§ç»­

2. **å®æ—¶åé¦ˆä¼˜åŒ–**
   - å³æ—¶æ˜¾ç¤ºæ­£ç¡®/é”™è¯¯
   - æä¾›è¯¦ç»†è§£æ
   - æ ¹æ®æ•™å­¦é£æ ¼è°ƒæ•´åé¦ˆæ·±åº¦

3. **ç»“æœé¡µé¢å¢å¼º**
   - èƒ½åŠ›é›·è¾¾å›¾åŠ¨æ€æ›´æ–°
   - é”™é¢˜ç›´æ¥åŠ å…¥é”™é¢˜æœ¬
   - ä¸€é”®å¼€å§‹é”™é¢˜ç»ƒä¹ 

---

### Phase 4: æ•°æ®åˆ†æä¸ä¼˜åŒ– (3-5 å¤©)

**ç›®æ ‡**: åŸºäºæ•°æ®æŒç»­æ”¹è¿›

1. **é¢˜ç›®è´¨é‡åˆ†æ**
   - ç»Ÿè®¡æ¯é“é¢˜çš„æ­£ç¡®ç‡
   - è¯†åˆ«"åé¢˜"ï¼ˆæ­£ç¡®ç‡å¼‚å¸¸ï¼‰
   - äººå·¥å®¡æ ¸ä½è´¨é‡é¢˜ç›®

2. **å­¦ä¹ æ•ˆæœè¿½è¸ª**
   - ç« èŠ‚å®Œæˆç‡ vs æµ‹è¯•é€šè¿‡ç‡
   - å­¦ä¹ æ—¶é•¿ vs æˆç»©æå‡
   - è¯†åˆ«é«˜æ•ˆå­¦ä¹ è·¯å¾„

3. **ä¸ªæ€§åŒ–æ¨è**
   - åŸºäºé”™é¢˜æ¨¡å¼æ¨èå¤ä¹ å†…å®¹
   - å»ºè®®ä¸‹ä¸€æ­¥å­¦ä¹ å†…å®¹
   - é¢„æµ‹å­¦ä¹ æ•ˆæœ

---

## ğŸ“ æ•°æ®æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–‡æ¡£ä¸Šä¼     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PDF è§£æ       â”‚
â”‚  - æå–å†…å®¹     â”‚
â”‚  - è¯†åˆ«ç« èŠ‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI ç”Ÿæˆé¢˜ç›®    â”‚ â† ExaminerAgent
â”‚  - 10é“é¢˜/ç«     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é¢˜ç›®åº“         â”‚
â”‚  - Question è¡¨  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·å¼€å§‹æµ‹è¯•   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç­”é¢˜è®°å½•       â”‚
â”‚  - QuizAttempt  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æˆç»©åˆ†æ       â”‚
â”‚  - æ­£ç¡®ç‡       â”‚
â”‚  - èƒ½åŠ›ç»´åº¦     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”ŸæˆæŠ¥å‘Š       â”‚
â”‚  - å­¦ä¹ å»ºè®®     â”‚
â”‚  - é”™é¢˜æœ¬       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ UI/UX è®¾è®¡å»ºè®®

### æµ‹è¯•å‡†å¤‡é¡µ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ ç¬¬1ç«  ç« èŠ‚æµ‹è¯•              â”‚
â”‚                                 â”‚
â”‚  æœ¬æµ‹è¯•åŒ…å« 10 é“é¢˜ç›®            â”‚
â”‚  é¢„è®¡ç”¨æ—¶: 15-20 åˆ†é’Ÿ            â”‚
â”‚                                 â”‚
â”‚  â˜ æˆ‘å·²å‡†å¤‡å¥½å¼€å§‹                â”‚
â”‚                                 â”‚
â”‚  [å¼€å§‹æµ‹è¯•]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç­”é¢˜é¡µ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬ 3/10 é¢˜        â±  05:23    â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚                                 â”‚
â”‚  [éš¾åº¦:â˜…â˜…â˜…] [ç†è§£åŠ›]          â”‚
â”‚                                 â”‚
â”‚  ä»¥ä¸‹å“ªä¸ªæ˜¯æ ·æœ¬ç©ºé—´çš„å®šä¹‰ï¼Ÿ      â”‚
â”‚                                 â”‚
â”‚  â—‹ A. æ‰€æœ‰å¯èƒ½ç»“æœçš„é›†åˆ         â”‚
â”‚  â— B. éƒ¨åˆ†ç»“æœçš„é›†åˆ            â”‚
â”‚  â—‹ C. å¿…ç„¶å‘ç”Ÿçš„äº‹ä»¶             â”‚
â”‚  â—‹ D. ä¸å¯èƒ½å‘ç”Ÿçš„äº‹ä»¶           â”‚
â”‚                                 â”‚
â”‚  [æäº¤ç­”æ¡ˆ]                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç»“æœé¡µ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‰ æµ‹è¯•å®Œæˆï¼                  â”‚
â”‚                                 â”‚
â”‚        â•­â”€â”€â”€â”€â•®                  â”‚
â”‚       â”‚ 85%â”‚  8.5/10            â”‚
â”‚        â•°â”€â”€â”€â”€â•¯                  â”‚
â”‚                                 â”‚
â”‚  âœ… é€šè¿‡æµ‹è¯•                     â”‚
â”‚                                 â”‚
â”‚  èƒ½åŠ›åˆ†æ                        â”‚
â”‚  â”œâ”€ ç†è§£åŠ›: â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80%         â”‚
â”‚  â”œâ”€ é€»è¾‘æ¨ç†: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%       â”‚
â”‚  â”œâ”€ æœ¯è¯­æŒæ¡: â–ˆâ–ˆâ–ˆâ–‘â–‘ 70%         â”‚
â”‚  â””â”€ åº”ç”¨èƒ½åŠ›: â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80%        â”‚
â”‚                                 â”‚
â”‚  éœ€è¦å¤ä¹ : çº¿æ€§æ–¹ç¨‹ç»„             â”‚
â”‚                                 â”‚
â”‚  [æŸ¥çœ‹é”™é¢˜] [ä¸‹ä¸€ç« ] [é‡æ–°æµ‹è¯•] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ æŠ€æœ¯è¦ç‚¹

### 1. é”™è¯¯å¤„ç†
```typescript
// å‰ç«¯ä¼˜é›…é™çº§
const loadQuestions = async () => {
  try {
    const response = await fetch(apiUrl)
    if (!response.ok) throw new Error('API é”™è¯¯')
    return await response.json()
  } catch (error) {
    // æ˜¾ç¤ºå‹å¥½é”™è¯¯
    toast.error('åŠ è½½é¢˜ç›®å¤±è´¥ï¼Œè¯·é‡è¯•')

    // æä¾›é‡è¯•é€‰é¡¹
    return {
      questions: generateFallbackQuestions(),
      isFallback: true
    }
  }
}
```

### 2. è¿›åº¦ä¿å­˜
```typescript
// é˜²æ­¢æ„å¤–åˆ·æ–°ä¸¢å¤±è¿›åº¦
useEffect(() => {
  const saveProgress = throttle(() => {
    localStorage.setItem('quiz_progress', JSON.stringify({
      currentQuestion,
      answers,
      timestamp: Date.now()
    }))
  }, 5000)

  return saveProgress()
}, [currentQuestion, answers])
```

### 3. æ€§èƒ½ä¼˜åŒ–
```python
# ä½¿ç”¨ç¼“å­˜å‡å°‘é‡å¤ç”Ÿæˆ
from functools import lru_cache

@lru_cache(maxsize=100)
def get_question_template(difficulty: int, dimension: str):
    """è·å–é¢˜ç›®æ¨¡æ¿ï¼Œé¿å…é‡å¤ç”Ÿæˆ"""
    ...
```

---

## ğŸ“Š æˆåŠŸæŒ‡æ ‡

### ç”¨æˆ·ä½“éªŒ
- âœ… æµ‹è¯•é¡µé¢åŠ è½½æ—¶é—´ < 2 ç§’
- âœ… é¢˜ç›®ç”Ÿæˆæ—¶é—´ < 30 ç§’ï¼ˆæˆ–ä½¿ç”¨é¢„ç”Ÿæˆï¼‰
- âœ… ç­”é¢˜å“åº”æ—¶é—´ < 500ms
- âœ… ç»“æœé¡µé¢å±•ç¤ºå®Œæ•´ä¿¡æ¯

### å­¦ä¹ æ•ˆæœ
- âœ… æµ‹è¯•é€šè¿‡ç‡ >= 60%
- âœ… é”™é¢˜é‡åšæ­£ç¡®ç‡æå‡ 20%
- âœ… ç« èŠ‚å®Œæˆç‡æå‡ 30%

### æŠ€æœ¯æŒ‡æ ‡
- âœ… API é”™è¯¯ç‡ < 1%
- âœ… é¢˜ç›®è´¨é‡åˆæ ¼ç‡ > 95%
- âœ… æ•°æ®åº“æŸ¥è¯¢æ—¶é—´ < 100ms

---

## ğŸ¯ æ€»ç»“

è¿™å¥—ç« èŠ‚æµ‹è¯•ä¸šåŠ¡æ–¹æ¡ˆçš„æ ¸å¿ƒä¼˜åŠ¿ï¼š

1. **AI é©±åŠ¨** - æ™ºèƒ½å‡ºé¢˜ï¼Œè‡ªé€‚åº”éš¾åº¦
2. **é—­ç¯è®¾è®¡** - æµ‹è¯• â†’ è¯„ä¼° â†’ å¤ä¹  â†’ æå‡
3. **ç”¨æˆ·ä½“éªŒ** - æµç•…äº¤äº’ï¼Œå³æ—¶åé¦ˆ
4. **æ•°æ®é©±åŠ¨** - æŒç»­ä¼˜åŒ–ï¼Œä¸ªæ€§åŒ–æ¨è

å»ºè®®ä¼˜å…ˆå®æ–½ï¼š
1. **Phase 1**: ä¿®å¤å½“å‰ bug
2. **Phase 2**: é›†æˆ AI å‡ºé¢˜
3. **Phase 3**: å®Œå–„æµ‹è¯•æµç¨‹

éœ€è¦æˆ‘å¼€å§‹å®æ–½å“ªä¸ªé˜¶æ®µå—ï¼Ÿ
