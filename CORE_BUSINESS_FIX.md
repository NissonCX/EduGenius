# ðŸŽ¯ æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½ä¿®å¤

## ä¿®å¤æ—¶é—´
2026-01-29

---

## æ ¸å¿ƒä¸šåŠ¡æµç¨‹

### ç”¨æˆ·ä¸Šä¼ æ•™æ â†’ AI è¯†åˆ«ç†è§£ â†’ åˆ’åˆ†ç« èŠ‚ â†’ ç”¨æˆ·å­¦ä¹ 

è¿™æ˜¯ EduGenius çš„æ ¸å¿ƒä»·å€¼é“¾ï¼Œå¿…é¡»ç¡®ä¿æ¯ä¸ªçŽ¯èŠ‚éƒ½æ­£å¸¸å·¥ä½œã€‚

---

## å·²å®Œæˆçš„ä¿®å¤

### 1. ç®€åŒ–æ–‡æ¡£ç®¡ç†é¡µé¢ âœ…

**é—®é¢˜**:
- ä¸Šä¼ éœ€è¦è·³è½¬åˆ°å•ç‹¬é¡µé¢
- ç”¨æˆ·ä½“éªŒä¸æµç•…
- Sidebar çš„ä¸Šä¼ æ¡†æ²¡æœ‰å®žé™…åŠŸèƒ½

**ä¿®å¤**:
- âœ… åˆå¹¶ä¸Šä¼ å’Œåˆ—è¡¨åŠŸèƒ½åˆ°ä¸€ä¸ªé¡µé¢ (`/documents`)
- âœ… åˆ é™¤å†—ä½™çš„ `/documents/upload` é¡µé¢
- âœ… Sidebar ä¸Šä¼ æ¡†æ”¹ä¸ºè·³è½¬åˆ°æ–‡æ¡£ç®¡ç†é¡µé¢
- âœ… ä¼˜åŒ–ä¸Šä¼ æµç¨‹ï¼Œå®žæ—¶åé¦ˆ

**æ–°é¡µé¢ç‰¹æ€§**:
- åœ¨åŒä¸€é¡µé¢å®Œæˆä¸Šä¼ å’Œç®¡ç†
- å®žæ—¶æ˜¾ç¤ºä¸Šä¼ è¿›åº¦
- æ¸…æ™°çš„æˆåŠŸ/å¤±è´¥æç¤º
- å¡ç‰‡å¼æ–‡æ¡£å±•ç¤º

### 2. ä¿®å¤ ChromaDB å…¼å®¹æ€§ âœ…

**é—®é¢˜**: ChromaDB v0.6.0 API å˜æ›´å¯¼è‡´æ–‡æ¡£å¤„ç†å¤±è´¥

**ä¿®å¤**: æ›´æ–° `api/app/core/chroma.py` ä½¿ç”¨æ–° API

### 3. ä¿®å¤è®¤è¯é—®é¢˜ âœ…

**é—®é¢˜**: Token æœªæ­£ç¡®å‘é€å¯¼è‡´ 401 é”™è¯¯

**ä¿®å¤**: ä¼˜åŒ– `getAuthHeaders` å‡½æ•°é€»è¾‘

### 4. æ·»åŠ ç¼ºå¤±çš„ API ç«¯ç‚¹ âœ…

**é—®é¢˜**: å‰ç«¯è°ƒç”¨ä¸å­˜åœ¨çš„ç«¯ç‚¹

**ä¿®å¤**: æ·»åŠ  `/api/documents/list` å’Œ `DELETE /api/documents/{id}`

---

## æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•æ¸…å•

### ðŸ“¤ æ–‡æ¡£ä¸Šä¼ æµç¨‹

- [ ] 1. è®¿é—® `/documents` é¡µé¢
- [ ] 2. ç‚¹å‡»"é€‰æ‹©æ–‡ä»¶"æŒ‰é’®
- [ ] 3. é€‰æ‹© PDF æˆ– TXT æ–‡ä»¶
- [ ] 4. ç‚¹å‡»"å¼€å§‹ä¸Šä¼ "
- [ ] 5. æŸ¥çœ‹ä¸Šä¼ è¿›åº¦
- [ ] 6. ç¡®è®¤ä¸Šä¼ æˆåŠŸæç¤º
- [ ] 7. æ–‡æ¡£å‡ºçŽ°åœ¨åˆ—è¡¨ä¸­

### ðŸ¤– AI æ–‡æ¡£å¤„ç†æµç¨‹

- [ ] 1. åŽç«¯æŽ¥æ”¶æ–‡ä»¶
- [ ] 2. è®¡ç®— MD5ï¼ˆåŽ»é‡ï¼‰
- [ ] 3. è§£æž PDF/TXT å†…å®¹
- [ ] 4. æ–‡æœ¬åˆ‡åˆ†ï¼ˆchunkï¼‰
- [ ] 5. ç”Ÿæˆå‘é‡åµŒå…¥ï¼ˆDashScopeï¼‰
- [ ] 6. å­˜å‚¨åˆ° ChromaDB
- [ ] 7. åˆ›å»ºæ•°æ®åº“è®°å½•

### ðŸ“š ç« èŠ‚åˆ’åˆ†æµç¨‹

- [ ] 1. æå–æ–‡æ¡£å…¨æ–‡
- [ ] 2. AI åˆ†æžæ–‡æ¡£ç»“æž„
- [ ] 3. è¯†åˆ«ç« èŠ‚æ ‡é¢˜
- [ ] 4. åˆ’åˆ†ç« èŠ‚å†…å®¹
- [ ] 5. åˆ›å»ºç« èŠ‚è¿›åº¦è®°å½•
- [ ] 6. è®¾ç½®ç« èŠ‚è§£é”è§„åˆ™

### ðŸŽ“ ç”¨æˆ·å­¦ä¹ æµç¨‹

- [ ] 1. æŸ¥çœ‹æ–‡æ¡£åˆ—è¡¨
- [ ] 2. ç‚¹å‡»"å¼€å§‹å­¦ä¹ "
- [ ] 3. æŸ¥çœ‹ç« èŠ‚åˆ—è¡¨
- [ ] 4. é€‰æ‹©ç« èŠ‚å­¦ä¹ 
- [ ] 5. AI å¯¹è¯è¾…å¯¼
- [ ] 6. å®Œæˆæµ‹éªŒ
- [ ] 7. è§£é”ä¸‹ä¸€ç« èŠ‚

---

## å¿«é€Ÿæµ‹è¯•è„šæœ¬

```bash
#!/bin/bash

echo "ðŸ§ª EduGenius æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•"
echo "=========================="
echo ""

# 1. æµ‹è¯•åŽç«¯å¥åº·
echo "1ï¸âƒ£ æµ‹è¯•åŽç«¯..."
curl -s http://localhost:8000/api/documents/health | jq .
echo ""

# 2. æ³¨å†Œæµ‹è¯•ç”¨æˆ·
echo "2ï¸âƒ£ æ³¨å†Œæµ‹è¯•ç”¨æˆ·..."
REGISTER=$(curl -s -X POST http://localhost:8000/api/users/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@edugenius.com",
    "username": "testuser",
    "password": "Test1234",
    "preferred_teaching_style": 3
  }')

TOKEN=$(echo "$REGISTER" | jq -r '.access_token')

if [ "$TOKEN" = "null" ]; then
  echo "ç”¨æˆ·å·²å­˜åœ¨ï¼Œå°è¯•ç™»å½•..."
  LOGIN=$(curl -s -X POST http://localhost:8000/api/users/login \
    -H "Content-Type: application/json" \
    -d '{"email":"test@edugenius.com","password":"Test1234"}')
  TOKEN=$(echo "$LOGIN" | jq -r '.access_token')
fi

echo "Token: ${TOKEN:0:30}..."
echo ""

# 3. åˆ›å»ºæµ‹è¯•æ–‡ä»¶
echo "3ï¸âƒ£ åˆ›å»ºæµ‹è¯•æ–‡æ¡£..."
cat > /tmp/test_doc.txt << 'EOF'
ç¬¬ä¸€ç« ï¼šçº¿æ€§ä»£æ•°åŸºç¡€

1.1 å‘é‡å’ŒçŸ©é˜µ
å‘é‡æ˜¯å…·æœ‰å¤§å°å’Œæ–¹å‘çš„é‡ã€‚åœ¨æ•°å­¦ä¸­ï¼Œå‘é‡å¯ä»¥ç”¨åæ ‡è¡¨ç¤ºã€‚

1.2 çŸ©é˜µè¿ç®—
çŸ©é˜µæ˜¯ç”±æ•°å­—ç»„æˆçš„çŸ©å½¢é˜µåˆ—ã€‚çŸ©é˜µå¯ä»¥è¿›è¡ŒåŠ æ³•ã€ä¹˜æ³•ç­‰è¿ç®—ã€‚

ç¬¬äºŒç« ï¼šå¾®ç§¯åˆ†å…¥é—¨

2.1 æžé™
æžé™æ˜¯å¾®ç§¯åˆ†çš„åŸºç¡€æ¦‚å¿µï¼Œæè¿°å‡½æ•°åœ¨æŸç‚¹é™„è¿‘çš„è¡Œä¸ºã€‚

2.2 å¯¼æ•°
å¯¼æ•°è¡¨ç¤ºå‡½æ•°çš„å˜åŒ–çŽ‡ï¼Œæ˜¯å¾®ç§¯åˆ†ä¸­çš„æ ¸å¿ƒæ¦‚å¿µã€‚
EOF

# 4. ä¸Šä¼ æ–‡æ¡£
echo "4ï¸âƒ£ ä¸Šä¼ æ–‡æ¡£..."
UPLOAD=$(curl -s -X POST http://localhost:8000/api/documents/upload \
  -H "Authorization: Bearer $TOKEN" \
  -F "file=@/tmp/test_doc.txt" \
  -F "title=æµ‹è¯•æ•™æ")

echo "$UPLOAD" | jq .
DOC_ID=$(echo "$UPLOAD" | jq -r '.document_id')
echo "æ–‡æ¡£ ID: $DOC_ID"
echo ""

# 5. ç­‰å¾…å¤„ç†
echo "5ï¸âƒ£ ç­‰å¾…æ–‡æ¡£å¤„ç†ï¼ˆ5ç§’ï¼‰..."
sleep 5

# 6. èŽ·å–ç« èŠ‚åˆ—è¡¨
echo "6ï¸âƒ£ èŽ·å–ç« èŠ‚åˆ—è¡¨..."
curl -s http://localhost:8000/api/documents/$DOC_ID/chapters \
  -H "Authorization: Bearer $TOKEN" | jq .
echo ""

# 7. æ¸…ç†
rm /tmp/test_doc.txt

echo "=========================="
echo "âœ… æµ‹è¯•å®Œæˆï¼"
```

---

## å¸¸è§é—®é¢˜æŽ’æŸ¥

### é—®é¢˜ 1: ä¸Šä¼ åŽæ²¡æœ‰ç« èŠ‚

**åŽŸå› **: ç« èŠ‚åˆ’åˆ†å¤±è´¥

**æ£€æŸ¥**:
```bash
# æŸ¥çœ‹åŽç«¯æ—¥å¿—
tail -f /tmp/edugenius_backend.log | grep "ç« èŠ‚"

# æŸ¥çœ‹æ•°æ®åº“
sqlite3 api/edugenius.db "SELECT * FROM progress WHERE document_id = 1;"
```

**è§£å†³**:
- ç¡®ä¿ DASHSCOPE_API_KEY å·²é…ç½®
- æ£€æŸ¥æ–‡æ¡£å†…å®¹æ˜¯å¦æœ‰æ˜Žç¡®çš„ç« èŠ‚æ ‡é¢˜
- æŸ¥çœ‹ `api/app/services/chapter_divider.py` çš„æ—¥å¿—

### é—®é¢˜ 2: æ–‡æ¡£å¤„ç†å¤±è´¥

**åŽŸå› **: PDF è§£æžæˆ–å‘é‡åŒ–å¤±è´¥

**æ£€æŸ¥**:
```bash
# æµ‹è¯• PDF è§£æž
python -c "
import fitz
doc = fitz.open('test.pdf')
print(f'é¡µæ•°: {len(doc)}')
print(f'ç¬¬ä¸€é¡µ: {doc[0].get_text()[:100]}')
"

# æµ‹è¯• DashScope API
python -c "
from dashscope import TextEmbedding
import os
os.environ['DASHSCOPE_API_KEY'] = 'your-key'
response = TextEmbedding.call(
    model='text-embedding-v2',
    input=['æµ‹è¯•æ–‡æœ¬']
)
print(response)
"
```

### é—®é¢˜ 3: ChromaDB é”™è¯¯

**åŽŸå› **: ç‰ˆæœ¬ä¸å…¼å®¹æˆ–æ•°æ®æŸå

**è§£å†³**:
```bash
# æ¸…ç©º ChromaDB
rm -rf api/chroma_db/*

# é‡æ–°ä¸Šä¼ æ–‡æ¡£
```

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. æ–‡æ¡£å¤„ç†å¼‚æ­¥åŒ–

å½“å‰æ˜¯åŒæ­¥å¤„ç†ï¼Œå¤§æ–‡ä»¶ä¼šé˜»å¡žè¯·æ±‚ã€‚å»ºè®®ï¼š
- ä½¿ç”¨ Celery æˆ– FastAPI BackgroundTasks
- è¿”å›žä»»åŠ¡ IDï¼Œå‰ç«¯è½®è¯¢çŠ¶æ€
- å¤„ç†å®ŒæˆåŽé€šçŸ¥ç”¨æˆ·

### 2. æ‰¹é‡å‘é‡åŒ–

å½“å‰é€ä¸ªç”Ÿæˆå‘é‡ï¼Œæ•ˆçŽ‡ä½Žã€‚å»ºè®®ï¼š
- æ‰¹é‡è°ƒç”¨ DashScope APIï¼ˆæ¯æ¬¡ 25 ä¸ªï¼‰
- ä½¿ç”¨è¿žæŽ¥æ± å¤ç”¨è¿žæŽ¥
- æ·»åŠ é‡è¯•æœºåˆ¶

### 3. ç¼“å­˜ä¼˜åŒ–

- ç¼“å­˜æ–‡æ¡£ MD5 æŸ¥è¯¢ç»“æžœ
- ç¼“å­˜ç« èŠ‚åˆ—è¡¨
- ä½¿ç”¨ Redis å­˜å‚¨ä¼šè¯

---

## ä¸‹ä¸€æ­¥ä¼˜åŒ–

1. **å¼‚æ­¥æ–‡æ¡£å¤„ç†** - å¤§æ–‡ä»¶ä¸é˜»å¡ž
2. **è¿›åº¦å®žæ—¶æŽ¨é€** - WebSocket æˆ– SSE
3. **æ™ºèƒ½ç« èŠ‚è¯†åˆ«** - æ”¹è¿› AI æç¤ºè¯
4. **æ–‡æ¡£é¢„è§ˆ** - ä¸Šä¼ å‰é¢„è§ˆå†…å®¹
5. **æ‰¹é‡æ“ä½œ** - æ‰¹é‡ä¸Šä¼ ã€åˆ é™¤

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
**æ›´æ–°æ—¶é—´**: 2026-01-29  
**çŠ¶æ€**: æ ¸å¿ƒåŠŸèƒ½å·²ä¿®å¤
